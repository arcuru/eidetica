# Forgejo CI workflow for security scanning
name: Security Scanning

on:
  schedule:
    # Run weekly on Mondays at 9:00 UTC
    - cron: "0 9 * * 1"
  pull_request:
    paths:
      - "**/Cargo.toml"
      - "**/Cargo.lock"
      - ".forgejo/workflows/security.yml"
  workflow_dispatch:

env:
  CARGO_TERM_COLOR: always
  RUST_VERSION: "1.92.0"

jobs:
  cargo-deny:
    name: Cargo Deny (License & Dependency Compliance)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4

      - name: Cache Rust toolchain and dependencies
        uses: actions/cache@0057852bfaa89a56745cba8c7296529d2fc39830 # v4
        with:
          path: |
            ~/.rustup
            ~/.cargo/registry
            ~/.cargo/git
            ~/.cargo/bin
            target
          key: ${{ runner.os }}-rust-${{ env.RUST_VERSION }}-security-${{ hashFiles('**/Cargo.lock', '**/Cargo.toml') }}
          restore-keys: |
            ${{ runner.os }}-rust-${{ env.RUST_VERSION }}-security-
            ${{ runner.os }}-rust-${{ env.RUST_VERSION }}-

      - name: Install Rust
        uses: https://github.com/dtolnay/rust-toolchain@f7ccc83f9ed1e5b9c81d8a67d7ad1a747e22a561
        with:
          toolchain: ${{ env.RUST_VERSION }}

      - name: Install cargo-deny
        uses: https://github.com/taiki-e/install-action@0e76c5c569f13f7eb21e8e5b26fe710062b57b62 # v2
        with:
          tool: cargo-deny

      - name: Run cargo-deny
        run: cargo deny check
